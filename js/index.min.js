const generalKnowledge="https://opentdb.com/api.php?amount=1&category=9&type=multiple",geography="https://opentdb.com/api.php?amount=1&category=22&type=multiple",art="https://opentdb.com/api.php?amount=1&category=25&type=multiple",sports="https://opentdb.com/api.php?amount=1&category=21&type=multiple",music="https://opentdb.com/api.php?amount=1&category=12&type=multiple",history="https://opentdb.com/api.php?amount=1&category=23&type=multiple",animals="https://opentdb.com/api.php?amount=1&category=27&type=multiple",science="https://opentdb.com/api.php?amount=1&category=17&type=multiple",lifeElement=document.querySelector(".quiz-container__life"),questionBox=document.querySelector(".quiz-container__gameboard__questions"),currentScore=document.querySelector(".quiz-container__gameboard__points__score"),highScore=document.querySelector(".highscore"),catContainer=document.querySelector(".quiz-container__gameboard__categories"),displayRound=document.querySelector(".quiz-container__gameboard__points__round-text");let currentCat,score=0,currentRound=0,activeQuestion=!1;const quizDuration=30;let secondsLeft,countdownInterval;const timeAnswer=3;let globalRightAnswer,timerInProgress=!1,lives=3,isGameOver=!1;document.querySelector(".quiz-container__gameboard__timer").style.display="none",localStorage.getItem("highscore")&&(highScore.innerHTML=localStorage.getItem("highscore"));const displayCategory=document.querySelector(".quiz-container__gameboard__categories-h2");displayRound.innerHTML=`Round: ${currentRound} of 3`;const quizHealth=new Health(lifeElement),categories=["generalKnowledge","geography","art","sports","music","history","animals","science"];function getRandomOrder(e){return e.sort((()=>Math.random()-.5)).slice(0,4)}function changeCatImg(e){const t=document.querySelector(".cat-image");t.src=`./img/cat${e}.png`,t.style.scale="0.3",setTimeout((()=>{t.style.scale="1"}),250)}function createCats(){getRandomOrder(categories).forEach((e=>{let t=document.createElement("div"),n=document.createElement("img");n.src=`./img/${e}.png`,n.alt=`${e} icon`,document.querySelector(".quiz-container__gameboard__categories").append(t),t.append(n),t.classList.add(e),t.classList.add("bubble"),n.classList.add("bubble__img"),t.addEventListener("click",(function(){switch(e){case"generalKnowledge":getQuestion(generalKnowledge),displayCategory.innerHTML="General knowledge",currentCat=generalKnowledge;break;case"geography":getQuestion(geography),displayCategory.innerHTML="Geography",currentCat=geography;break;case"art":getQuestion(art),displayCategory.innerHTML="Art",currentCat=art;break;case"sports":getQuestion(sports),displayCategory.innerHTML="Sports",currentCat=sports;break;case"music":getQuestion(music),displayCategory.innerHTML="Music",currentCat=music;break;case"history":getQuestion(history),displayCategory.innerHTML="History",currentCat=history;break;case"animals":getQuestion(animals),displayCategory.innerHTML="Animals",currentCat=animals;break;case"science":getQuestion(science),displayCategory.innerHTML="Science",currentCat=science}document.querySelector(".card").classList.toggle("flipped"),changeCatImg(1)}))}))}async function getQuestion(e){try{const t=await fetch(e);if(!t.ok)throw new Error("HTTP"+t.status);genQuestion((await t.json()).results[0])}catch(e){console.error(e)}}function genQuestion(e){displayRound.style.marginRight="0px",changeCatImg(1),currentRound++,displayRound.innerHTML=`Round: ${currentRound} of 3`,activeQuestion=!1,questionBox.innerHTML="";const t=e.question,n=document.createElement("h2");n.classList.add("question"),n.innerHTML=t,questionBox.append(n);const o=e.correct_answer;getRandomOrder([...e.incorrect_answers,o]).forEach(((e,t)=>{const n=document.createElement("div");n.classList.add("answer"),n.innerHTML=e,questionBox.append(n),setTimeout((()=>{setTimeout((()=>{n.style.opacity="1"}),200*t),timerInProgress=!0,n.addEventListener("click",(()=>{activeQuestion||(activeQuestion=!0,checkAnswer(e,o),globalRightAnswer=o,showCorrectAnswer(document.querySelectorAll(".answer"),o),3!==currentRound||isGameOver?setTimeout((()=>{isGameOver||getQuestion(currentCat)}),2e3):setTimeout((()=>{newRound()}),2e3))}))}),2e3)}))}function newRound(){questionBox.innerHTML="",displayRound.style.marginRight="-800px",currentCat="",currentRound=0,timerInProgress=!1,catContainer.innerHTML="",displayCategory.innerHTML="Choose your next category",changeCatImg(2),document.querySelector(".card").classList.toggle("flipped"),isGameOver||createCats()}function checkAnswer(e,t){t===e?(changeCatImg(3),addTime(),updateScore(),timerInProgress=!1):(decreaseTime(),changeCatImg(4),quizHealth.removeLife(),lives-=1,timerInProgress=!1,0===lives&&(isGameOver=!0,setTimeout((()=>{gameOver()}),800)))}function showCorrectAnswer(e,t){const n=(new DOMParser).parseFromString(t,"text/html");e.forEach((e=>{e.innerHTML===n.documentElement.textContent?(e.style.backgroundColor="#2A9134",e.style.boxShadow="4px 4px white, 8px 8px #2A9134, rgba(0, 0, 0, 0.6) 15px 15px 20px"):(e.style.backgroundColor="#FF4A1C",e.style.boxShadow="4px 4px white, 8px 8px #FF4A1C, rgba(0, 0, 0, 0.6) 15px 15px 20px")}))}function updateScore(){score++,currentScore.innerHTML=`Score: ${score}`,score>localStorage.getItem("highscore")&&localStorage.setItem("highscore",score)}function startCountdown(){document.querySelector(".quiz-container__gameboard__timer").style.display="block",secondsLeft=quizDuration,document.querySelector("#timer").style.width="100%",document.getElementById("timer").style.backgroundColor="#90EE90",countdownInterval=setInterval((()=>{secondsLeft>0?(document.getElementById("timer").style.backgroundColor=secondsLeft<6?"#ff0000":secondsLeft<16?"yellow":"#90EE90",timerInProgress&&!isGameOver&&(secondsLeft-=1),document.getElementById("timer").style.width=secondsLeft/quizDuration*100+"%"):(isGameOver=!0,setTimeout((()=>{gameOver()}),800),timerInProgress=!1,clearInterval(countdownInterval))}),1e3)}function addTime(){secondsLeft+=timeAnswer,secondsLeft>quizDuration&&(secondsLeft=quizDuration)}function decreaseTime(){secondsLeft-=timeAnswer,secondsLeft>quizDuration&&(secondsLeft=quizDuration)}function gameOver(){const e=document.createElement("img");e.src="./img/gameOver.png",e.alt="Game over image";const t=document.createElement("div");t.classList.add("gameOverDiv"),t.append(e),document.body.append(t),setTimeout((()=>{e.style.opacity="1",e.style.scale="0.5"}),40),setTimeout((()=>{const e=document.createElement("button");e.classList.add("restartQuiz"),document.querySelector(".quiz-container__gameboard__cat").append(e),e.innerHTML="Play again?",e.addEventListener("click",(()=>{window.location.reload()}))}),1e3)}createCats(),startCountdown();